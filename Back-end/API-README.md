## API Documentation

Here is the full description of the OnAux backend API.


## Models & API Endpoints Documentation

Models:

1. [User](#user)
2. [Session](#session)


Testing via Postman:

[Testing](#testing)

---

### User

### Schema

| Field          | Type    | Required | Details                                                      |
| -------------- | ------- | -------- | ------------------------------------------------------------ |
| firstName         | String     | Yes      |                  |   
| lastName         | String     | Yes      |                  |   
| userID         | _id     | Yes      | Generated by Mongo, no client code is needed                 |   
| username       | String  | Yes      | unique                                                       |
| email          | String  | Yes      | unique                                                       |
| password       | String  | Yes      |                                                              |
| profilePic     | Buffer  |          |                                                              |
| createdAt      | Date    |          |                                                              |
| tokens         | Array   |          |                                                              |
| djSessionID    | _id     |          |  `sessionID`                                                 |
| likedSongs    | Array     |          |                                                   |

### API Endpoints

| API end-point               | HTTP Method | Required Fields                                                    |  Description                         |
| --------------------------- | ----------- | ------------------------------------------------------------------ | ------------------------------------ |   
| [Login](#login)                | POST        | `username`, `password`                                             |Creates and Returns a JWT Token associated with the user  |
| [Signup](#signup)                | POST        | `username` , `email`, `password`, `firstName`, `lastName` | Registers a user in Database and returns a JWT Token for authentication      |
| [Logout](#logout)              | POST        | None                                                               |         Removes the JWT Token from the user association  | 
| [Get-User](#get-user)     | GET         | Passing `userID` as a parameter                                    | Returns userInfo with given `userID`  | 
| [Upload-Pic](#upload-pic)          | POST        | key: `profile-pic`  , type: `.jpg`, `.png` or `.jpeg`              |          Uploads picture to user profile         |
| [Get-Profile-Pic](#get-profile-pic)        | GET         | None                                                               |   Returns user profile picture          |
| [Delete-Profile-Pic](#delete-profile-pic)           | DELETE      | None                                                       |   Delets user profile picture        |
| [Add-Song](#add-song)              | POST        | `songInfo object` with `songuri`, `songName`, `artist`, `album` in body    | Returns array of songs + information |
| [Get-Likes](#get-likes)                | GET         | None                                             | Returns array of user's liked songs |
| [Remove-Song](#remove-song)          | DELETE      | `songInfo object` with `songuri` in body           | Removes the song with `songuri` from user's likes and returns updated array of liked songs |

---

#### Login

```
Method: POST

End-point : /user/login

Request-Body:
   {
      "username": "newuser",
      "password" : "12d34"
   }

Backend-Response:
   {
      "user": {
         "createdAt": "2020-11-23T04:58:10.240Z",
         "_id": "5fbb41ada4d1c10c041178de",
         "username": "newuser",
         "firstName": "Ali",
         "lastName": "lastName",
         "email": "ali1d@gmail.com",
         "likedSongs": [
               {
                  "songuri": "984941512",
                  "songName": "The Adults are Talking",
                  "artist": "The Strokes",
                  "album": "Single"
               }
         ],
         "__v": 4,
         "djSessionID": "5fbb41b3a4d1c10c041178e0"
      },
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFsaTFkQGdtYWlsLmNvbSIsImlhdCI6MTYwNzAzMTA0OCwiZXhwIjoxNjA3MTE3NDQ4fQ.fZ-4lbVrcHKmgXx4hg0YEkDdtMdCXBTaI0xS9VDSRlU"
   }
```

#### Signup

```
Method: POST

End-point : /user/signup

Request-Body:
   {
      "username": "newuser2",
      "firstName" : "Ali",
      "lastName" : "lastName",
      "email": "ali1d3@gmail.com",
      "password" : "12d34"
   }

Backend-Response:
   {
      "user": {
         "createdAt": "2020-12-03T21:30:41.164Z",
         "_id": "5fc959be017ed58034cec08d",
         "username": "newuser3",
         "firstName": "Ali",
         "lastName": "lastName",
         "email": "ali@gmail.com",
         "likedSongs": [],
         "__v": 1
      },
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFsaUBnbWFpbC5jb20iLCJpYXQiOjE2MDcwMzEyMzAsImV4cCI6MTYwNzExNzYzMH0.8-5lQ9bCwhCgO131tP6aI5Y9QaIvEC0LMJ8RsVxBo7k"
   }
```


#### Logout

```
Method: POST

End-point : /user/logout

Backend-Response:
   User Logged out!
```

#### Get-User

```
Method: GET

End-point : /user/user-id=:userID

Params:
   1. userID

Backend-Response:
   {
      "userInfo": {
         "createdAt": "2020-12-03T21:30:41.164Z",
         "_id": "5fc959be017ed58034cec08d",
         "username": "newuser3",
         "firstName": "Ali",
         "lastName": "lastName",
         "email": "ali@gmail.com",
         "likedSongs": [
               {
                  "songuri": "984941512",
                  "songName": "The Adults are Talking",
                  "artist": "The Strokes",
                  "album": "Single"
               }
         ],
         "__v": 2
      }
   }
```

#### Upload-Pic

```
Method: POST

End-point : /user/profile-pic

Request-Body:
   key: profile-pic
   value: picture that wnats to be uploaded

```
#### Get-Profile-Pic

```
Method: GET

End-point : /user/profile-pic

```

#### Delete-Profile-Pic

```
Method: DELETE

End-point : /user/profile-pic
```
#### Add-Song

```
Method: POST

End-point : /user/add-song

Request-Body:
   {
      "songInfo": {
         "songuri" : "0176789",
         "songName" : "One of these Nights",
         "artist" : "The Eagles",
         "album" : "Single"
      }
   }

Backend-Response:
   [
      {
         "songuri": "0176789",
         "songName": "One of these Nights",
         "artist": "The Eagles",
         "album": "Single"
      }
   ]
```

#### Get-Likes

```
Method: GET

End-point : /user/likes


Backend-Response:
   [
      {
         "songuri": "0176789",
         "songName": "One of these Nights",
         "artist": "The Eagles",
         "album": "Single"
      },
      {
         "songuri": "0176783",
         "songName": "Heartless",
         "artist": "The Weeknd",
         "album": "After Hours"
      }
   ]
```
#### Remove-Song

```
Method: DELETE

End-point : /user/likes

Request-Body:
   {
      "songInfo": {
         "songuri" : "0176789"
      }
   }

Backend-Response:
   [
      {
         "songuri": "0176783",
         "songName": "Heartless",
         "artist": "The Weeknd",
         "album": "After Hours"
      }
   ]
```

### Session

### Schema

| Field          | Type    | Required | Details                                                      |
| -------------- | ------- | -------- | ------------------------------------------------------------ |
| sessionID      | _id     | Yes      | Generated by Mongo, no client code is needed                |
| sessionName    | String  | Yes      |                                                              |
| owner          | _id     |          |  `userID`                                                    |
| currentSongInfo    | Object  |          |                                                              |
| nextSong       | String  |          |                                                              |
| createdAt      | Date    |          |                                                              |
| histroy        | Array   |          |                                                              |
| requestedSongsMap  | HashMap   |          |                                                              |
| requestedSongObj      | Array     | Yes      | Song Object with their votes              |


### API Endpoints

| API end-point                     | HTTP Method | Required Fields                      | Description                                                                                              |
| ---------------------------       | ----------- | ------------------------------------ | -------------------------------------------------------------------------------------------------------- |
| [Create-Session](#create-session)                  | POST        | `sessionName`                        | Create a new session to become a DJ, Returns userInfo with sessionID + newly created Session information |
| [Get-Session](#get-session)   | GET         | passing `sessionID` as a parameter   | Get all information about a session, has to pass the sessionID as a parameter                            |
| [Get-All-Session](#get-all-sessions)                     | GET         | None                                 | Returning all available/active sessions with their `sessionName`s and `sessionID`s                        |
| [Request-Song](#request-song)                  | POST         | `sessionID` as a  param, `songInfo` and `vote`(+1/-1) in body                                | returning the updated session in JSON                         |
| [Set-Current-Song](#set-current-song)                   | POST        | `sessionID`, `songInfo` as a body                           | Set the current soong being played                         |
| [Add-Song-History](#add-song-history)                  | POST        | Song object in the body                    | Adding a song to the session history |
| [Get-Session-History](#get-session-history)                  | GET        | Song object  in the body                       | Get the session hostory|


---


#### Create-Session

```
Method: POST

End-point : /session/create

Request-Body:
   {
      "sessionName" : "Adam's session"
   }

Backend-Response:
   {
      "userAsDJWithSessionID": {
         "createdAt": "2020-12-03T21:30:41.164Z",
         "_id": "5fc95d8b017ed58034cec091",
         "username": "newuser3e",
         "firstName": "Ali",
         "lastName": "lastName",
         "email": "alie@gmail.com",
         "likedSongs": [
               {
                  "songuri": "984941512",
                  "songName": "The Adults are Talking",
                  "artist": "The Strokes",
                  "album": "Single"
               }
         ],
         "__v": 4,
         "djSessionID": "5fc964b9017ed58034cec097"
      },
      "newSessionInfo": {
         "createdAt": "2020-12-03T21:30:41.139Z",
         "_id": "5fc964b9017ed58034cec097",
         "sessionName": "Adam's session",
         "owner": "5fc95d8b017ed58034cec091",
         "history": [],
         "requestedSongObj": [],
         "__v": 0
      }
   }
```

#### Get-Session

```
Method: GET

End-point : /session/session-id=:sessionID

Params:
   1. sessionID

Backend-Response:
   {
      "createdAt": "2020-12-02T05:46:23.292Z",
      "_id": "5fc72a43710d3803f4fff129",
      "sessionName": "Adam's session",
      "owner": "5fc713a0b6dea9fb5c0136f9",
      "history": [
         {
            "songuri": "0176789",
            "songName": "One of these Nights",
            "artist": "The Eagles",
            "album": "Single"
        },
        {
            "songuri": "849846161",
            "songName": "Love Life",
            "artist": "Ghostland Observatory",
            "album": "Single"
        }
      ],
      "requestedSongObj": [
         {
               "_id": "5fc72a58710d3803f4fff12b",
               "songuri": "8498462",
               "songName": "Sad Sad City",
               "artist": "Ghostland Observatory",
               "album": "Single",
               "vote": 2
         },
         {
               "_id": "5fc72ae09c27cb0470b771ef",
               "songuri": "8498463",
               "songName": "Bad & Boujee",
               "artist": "Migos",
               "album": "Single",
               "vote": -2
         },
         {
               "_id": "5fc72afb9c27cb0470b771f0",
               "songuri": "84938463",
               "songName": "Fight Night",
               "artist": "Migos",
               "album": "Single",
               "vote": 1
         }
      ],
      "__v": 4
   }
```

#### Get-All-Sessions

```
Method: GET

End-point : /session/all

Backend-Response:
[
    {
        "_id": "5fadd2868ee28252e1416d80",
        "sessionName": "Adam's session"
    },
    {
        "_id": "5fbb41b3a4d1c10c041178e0",
        "sessionName": "Ali's session"
    },
    {
        "_id": "5fbefa66cdee235c6bced5cc",
        "sessionName": "Nick's session"
    },
    {
        "_id": "5fc713a4b6dea9fb5c0136fb",
        "sessionName": "Emily's session"
    },
    {
        "_id": "5fc72a43710d3803f4fff129",
        "sessionName": "Hannah's session"
    }
]
```

#### Request-Song

```
Method: POST

End-point : /session/session-id=:sessionID/request-song

Request-Body:
   {
      "songInfo": {
         "songuri" : "84938463",
         "songName" : "Bad & Boujee",
         "artist" : "Migos",
         "album" : "Single"
      },
      "vote" : "1"
   }

Backend-Response:
   {
      "createdAt": "2020-12-02T05:46:23.292Z",
      "_id": "5fc72a43710d3803f4fff129",
      "sessionName": "Adam's session",
      "owner": "5fc713a0b6dea9fb5c0136f9",
      "history": [
        {
            "songuri": "0176789",
            "songName": "One of these Nights",
            "artist": "The Eagles",
            "album": "Single"
        },
        {
            "songuri": "849846161",
            "songName": "Love Life",
            "artist": "Ghostland Observatory",
            "album": "Single"
        }
      ],
      "requestedSongObj": [
         {
               "_id": "5fc72a58710d3803f4fff12b",
               "songuri": "8498462",
               "songName": "Sad Sad City",
               "artist": "Ghostland Observatory",
               "album": "Single",
               "vote": 2
         },
         {
               "_id": "5fc72ae09c27cb0470b771ef",
               "songuri": "8498463",
               "songName": "Fight Night",
               "artist": "Migos",
               "album": "Single",
               "vote": -2
         },
         {
               "_id": "5fc96651017ed58034cec099",
               "songuri": "84938463",
               "songName": "Bad & Boujee",
               "artist": "Migos",
               "album": "Single",
               "vote": 3
         }
      ],
      "__v": 6
   }
```

#### Set-Current-song

```
Method: POST

End-point : /session/session-id=:sessionID/set-current-song

Request-Body:
   {
      "songInfo": {
         "songuri" : "849846161",
         "songName" : "Sad Sad City",
         "artist" : "Ghostland Observatory",
         "album" : "Single"
      }
   }

Backend-Response:
{
    "currentSongInfo": {
        "songuri": "849846161",
        "songName": "Sad Sad City",
        "artist": "Ghostland Observatory",
        "album": "Single"
    },
    "createdAt": "2020-11-23T04:58:10.223Z",
    "_id": "5fbb41b3a4d1c10c041178e0",
    "sessionName": "Adam's session",
    "owner": "5fbb41ada4d1c10c041178de",
    "history": [],
    "__v": 1,
    "requestedSongObj": []
}
```

#### Add-Song-History

```
Method: POST

End-point : /session/session-id=:sessionID/history/add-song

Request-Body:
   {
      "songInfo": {
         "songuri" : "849846161",
         "songName" : "Sad Sad City",
         "artist" : "Ghostland Observatory",
         "album" : "Single"
      }
   }

Backend-Response:
[
    {
        "songuri": "849846161",
        "songName": "Sad Sad City",
        "artist": "Ghostland Observatory",
        "album": "Single"
    },
    {
        "songuri": "849846121",
        "songName": "Bad & Boujee",
        "artist": "Migos",
        "album": "Single"
    }
]
```

#### Get-Session-History

```
Method: GET

End-point : /session/session-id=:sessionID/history/

Backend-Response:
   [
      {
         "songuri": "849846161",
         "songName": "Sad Sad City",
         "artist": "Ghostland Observatory",
         "album": "Single"
      },
      {
         "songuri": "849846121",
         "songName": "Bad & Boujee",
         "artist": "Migos",
         "album": "Single"
      }
   ]
```
---
## Testing
---

**Prerequisites for API Testing**
1. Open a teminal session to UCLA-CS-130---SWE---OnAux/ root and run `mongod`
2. Open another teminal session to UCLA-CS-130---SWE---OnAux/Back-end/ directory and run `npm run dev`
3. Open Postman app

**Running APIs in postman**
1. Precede all API endpoints with `localhost:8000`
2. Add an environment variable in the top right called `token`.  You will update this token in API testing, and it is how our backend authenticates API requests.
3. Click `New Request` in the upper left hand corner.
4. Fill in the API request url, specify the type of API request, and the required API body or params.

**API Unit Testing Order**
1. Call the [Signup](#signup) API and create a user.  Copy the returned token into the value of your `token` environment variable.
2. Call [Create-Session](#create-session) to make yourself a DJ and create an empty Session.  Take the Session ID from the API response.
3. [Set-Current-Song](#set-current-song) to whatever song you would like.
4. Call [Add-Song-History](#add-song-history) to add a song to the Session history.  Repeat this a few times with different songs.
5. Check the history of the Session with [Get-Session-History](#get-session-history).
6. Now from the perspective of a Listener, [Request-Song](#request-song) to the DJ's session.
7. You really liked a song that the DJ played, so [Add-Song](#add-song) to your likes list.
8. You check your updated user likes with [Get-Likes](#get-likes).
9. When you are done, you decide to [Logout](#logout).  Try running another API request [Get-Likes](#get-likes) to show we logged out!
